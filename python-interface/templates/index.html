<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoboTech</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>ü§ñ RoboTech Control Center</h1>
            <div class="connection-status" id="connectionStatus">
                <span class="status-indicator" id="statusIndicator"></span>
                <span id="statusText">Disconnected</span>
            </div>
        </header>

        <!-- Connection Section - Always Visible -->
        <section class="connection-section">
            <div class="panel connection-panel">
                <h2>üîå Robot Connection</h2>
                <div class="connection-controls">
                    <button id="connectBtn" class="btn btn-primary">üöÄ Connect to Robot</button>
                    <button id="disconnectBtn" class="btn btn-secondary" style="display: none;">üîå Disconnect</button>
                </div>
                <div class="connection-info" id="connectionInfo" style="display: none;">
                    <div class="info-item">
                        <span class="label">Position:</span>
                        <span id="robotPosition">X: 0, Y: 0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Angle:</span>
                        <span id="robotAngle">0¬∞</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Status:</span>
                        <span id="robotStatus">Connecting...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Welcome Instructions - Visible When Disconnected -->
        <div id="welcomeSection" class="welcome-section">
            <div class="panel welcome-panel">
                <h2 style="color: #000;">üëã Welcome to RoboTech!</h2>
                <div class="welcome-content" style="color: #000;">
                    <p><strong>üöÄ Get started in 3 easy steps:</strong></p>
                    <ol class="welcome-steps" style="color: #000;">
                        <li>üîå Click "Connect to Robot" above</li>
                        <li>‚è≥ Wait for connection to establish</li>
                        <li>üéÆ Start controlling your robot!</li>
                    </ol>
                    <div class="features-preview" style="color: #000;">
                        <h3 style="color: #000;">‚ú® Features unlocked after connection:</h3>
                        <div class="feature-grid">
                            <div class="feature-item">
                                <span class="feature-icon">üéÆ</span>
                                <span class="feature-name">Robot Control</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üó∫Ô∏è</span>
                                <span class="feature-name">Live Mapping</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üì°</span>
                                <span class="feature-name">LiDAR Scanner</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üîÆ</span>
                                <span class="feature-name">AR Features</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Dashboard - Hidden Until Connected -->
        <div id="controlDashboard" class="control-dashboard" style="display: none;">
            
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div class="dashboard-title">
                    <h1>üéÆ RoboTech Control Dashboard</h1>
                    <div class="dashboard-status">
                        <span class="status-badge connected">üü¢ CONNECTED</span>
                        <span class="connection-time">Connected: <span id="dashboardConnectionTime">00:00</span></span>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard Content -->
            <main class="dashboard-content">
                
                <!-- Robot Status Panel -->
                <section class="dashboard-panel status-panel">
                    <h3>üìä Robot Status</h3>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">Position</div>
                            <div class="status-value">
                                <span id="dashPosition">X: 0.0, Y: 0.0</span>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Heading</div>
                            <div class="status-value">
                                <span id="dashHeading">0¬∞</span>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Speed</div>
                            <div class="status-value">
                                <span id="dashSpeed">0.0 m/s</span>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Battery</div>
                            <div class="status-value">
                                <span id="dashBattery">100%</span>
                                <div class="battery-indicator">
                                    <div class="battery-level" id="batteryLevel"></div>
                                </div>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">Current Action</div>
                            <div class="status-value">
                                <span id="dashCurrentAction">Idle</span>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">LiDAR Status</div>
                            <div class="status-value">
                                <span id="dashLidarStatus">üü¢ Active</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Movement Controls -->
                <section class="dashboard-panel controls-panel">
                    <h3>üïπÔ∏è Movement Controls</h3>
                    <div class="control-interface">
                        <div class="movement-controls">
                            <button class="control-btn primary" id="forwardBtn">
                                <span class="btn-icon">‚¨ÜÔ∏è</span>
                                <span class="btn-text">Forward</span>
                            </button>
                            <div class="side-controls">
                                <button class="control-btn primary" id="leftBtn">
                                    <span class="btn-icon">‚¨ÖÔ∏è</span>
                                    <span class="btn-text">Left</span>
                                </button>
                                <button class="control-btn stop" id="stopBtn">
                                    <span class="btn-icon">üõë</span>
                                    <span class="btn-text">STOP</span>
                                </button>
                                <button class="control-btn primary" id="rightBtn">
                                    <span class="btn-icon">‚û°Ô∏è</span>
                                    <span class="btn-text">Right</span>
                                </button>
                            </div>
                            <button class="control-btn primary" id="backwardBtn">
                                <span class="btn-icon">‚¨áÔ∏è</span>
                                <span class="btn-text">Backward</span>
                            </button>
                        </div>
                        <div class="speed-control">
                            <label for="speedSlider">Speed Control:</label>
                            <input type="range" id="speedSlider" min="0.1" max="2.0" step="0.1" value="1.0">
                            <span id="speedValue">1.0 m/s</span>
                        </div>
                    </div>
                </section>

                <!-- System Controls -->
                <section class="dashboard-panel system-panel">
                    <h3>‚öôÔ∏è System Controls</h3>
                    <div class="system-controls">
                        <button class="control-btn warning" id="emergencyStopBtn">
                            <span class="btn-icon">üö®</span>
                            <span class="btn-text">EMERGENCY STOP</span>
                        </button>
                        <button class="control-btn secondary" id="resetPositionBtn">
                            <span class="btn-icon">üéØ</span>
                            <span class="btn-text">Reset Position</span>
                        </button>
                        <button class="control-btn secondary" id="calibrateBtn">
                            <span class="btn-icon">‚öôÔ∏è</span>
                            <span class="btn-text">Calibrate</span>
                        </button>
                        <button class="control-btn danger" id="shutdownBtn">
                            <span class="btn-icon">‚ö°</span>
                            <span class="btn-text">SHUTDOWN</span>
                        </button>
                    </div>
                </section>

                <!-- Live Data Visualization -->
                <section class="dashboard-panel visualization-panel">
                    <h3>üó∫Ô∏è Live Map & LiDAR</h3>
                    <div class="visualization-container">
                        <div class="map-section">
                            <h4>Real-time Map</h4>
                            <canvas id="mapCanvas" width="350" height="300"></canvas>
                            <div class="map-controls">
                                <button id="clearMapBtn" class="btn-small">üóëÔ∏è Clear</button>
                                <button id="centerMapBtn" class="btn-small">üéØ Center</button>
                                <button id="saveMapBtn" class="btn-small">üíæ Save</button>
                            </div>
                        </div>
                        <div class="lidar-section">
                            <h4>LiDAR Scanner</h4>
                            <canvas id="lidarCanvas" width="300" height="300"></canvas>
                            <div class="lidar-info">
                                <div class="info-row">
                                    <span>Scan Points:</span>
                                    <span id="lidarPointCount">0</span>
                                </div>
                                <div class="info-row">
                                    <span>Min Distance:</span>
                                    <span id="nearestDistance">-- m</span>
                                </div>
                                <div class="info-row">
                                    <span>Max Range:</span>
                                    <span>5.0 m</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- AR & Navigation -->
                <section class="dashboard-panel ar-panel">
                    <h3>üîÆ AR & Navigation</h3>
                    <div class="ar-container">
                        <div class="compass-display">
                            <div class="ar-compass" id="arCompass">
                                <div class="compass-needle" id="compassNeedle"></div>
                                <div class="compass-directions">
                                    <span class="compass-n">N</span>
                                    <span class="compass-e">E</span>
                                    <span class="compass-s">S</span>
                                    <span class="compass-w">W</span>
                                </div>
                            </div>
                            <div class="compass-info">
                                <div>Heading: <span id="arHeading">0¬∞</span></div>
                            </div>
                        </div>
                        <div class="navigation-info">
                            <h4>üß≠ Navigation Assistant</h4>
                            <div class="nav-item">
                                <span class="nav-label">Obstacle Distance:</span>
                                <span id="obstacleDistance" class="nav-value">-- m</span>
                            </div>
                            <div class="nav-item">
                                <span class="nav-label">Suggested Action:</span>
                                <span id="suggestedAction" class="nav-value">Move Forward</span>
                            </div>
                            <div class="nav-item">
                                <span class="nav-label">Path Clear:</span>
                                <span id="pathStatus" class="nav-value">‚úÖ Clear</span>
                            </div>
                            <div class="nav-item">
                                <span class="nav-label">Goal Distance:</span>
                                <span id="goalDistance" class="nav-value">-- m</span>
                            </div>
                            <div class="nav-item">
                                <span class="nav-label">ETA:</span>
                                <span id="eta" class="nav-value">--</span>
                            </div>
                            <div class="nav-item">
                                <span class="nav-label">Next Turn:</span>
                                <span id="nextTurn" class="nav-value">--</span>
                            </div>
                        </div>
                    </div>
                    <div class="ar-settings">
                        <label class="toggle-item"><input type="checkbox" id="toggleFOV" checked> Show FOV</label>
                        <label class="toggle-item"><input type="checkbox" id="toggleBreadcrumbs" checked> Breadcrumbs</label>
                        <label class="toggle-item"><input type="checkbox" id="toggleSafety" checked> Safety Bubble</label>
                        <label class="toggle-item"><input type="checkbox" id="toggleWaypointMode"> Waypoint Mode</label>
                    </div>
                    <div class="ar-safety">
                        <label for="safetyRadius">Safety Radius</label>
                        <input type="range" id="safetyRadius" min="0.3" max="2.0" step="0.1" value="0.7">
                        <span id="safetyRadiusValue">0.7 m</span>
                    </div>
                    <div class="ar-controls">
                        <button id="toggleArBtn" class="btn-small">üëÅÔ∏è Toggle AR</button>
                        <button id="autoNavigateBtn" class="btn-small">ü§ñ Auto Navigate</button>
                        <button id="clearWaypointsBtn" class="btn-small">üó∫Ô∏è Clear Waypoints</button>
                        <button id="clearBreadcrumbsBtn" class="btn-small">üßµ Clear Breadcrumbs</button>
                    </div>
                    <!-- Optional AR view placeholder for future camera HUD; kept hidden by default -->
                    <div id="arView" style="display:none"></div>
                </section>

            </main>
        </div>

        <!-- Footer -->
        <footer>
            <p>RoboTech Web Controller - Simple & Easy to Use</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>